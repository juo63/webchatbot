<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í¥ÄÎ¶¨Ïûê - ÎåÄÌôî Î°úÍ∑∏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background: radial-gradient(circle at center, #808080 0%, #707070 20%, #606060 40%, #505050 60%, #404040 80%, #303030 100%);
            min-height: 100vh;
        }
        .header {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #808080;
        }
        .header h1 {
            margin: 0;
            color: #333;
        }
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        .btn-primary {
            background: radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-blocked {
            background: radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-feedback {
            background: radial-gradient(circle at center, #28a745 0%, #218838 40%, #1e7e34 70%, #155724 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-feedback.dislike {
            background: radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%);
        }
        
        .btn-secondary {
            background: radial-gradient(circle at center, #6c757d 0%, #5a6268 40%, #495057 70%, #343a40 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            text-align: center;
            border: 1px solid #808080;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .controls {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #808080;
        }
        .feedback-section {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            border: 1px solid #808080;
        }
        .log-item {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            margin-bottom: 15px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            overflow: hidden;
            border: 1px solid #808080;
        }
        .log-header {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
        }
        .log-time {
            color: #666;
            font-size: 14px;
        }
        .log-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-fallback {
            background: #f8d7da;
            color: #721c24;
        }
        .log-content {
            padding: 20px;
        }
        .log-question {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-radius: 0px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        .log-answer {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-radius: 0px;
            white-space: pre-wrap;
            line-height: 1.5;
            border: 1px solid #dee2e6;
        }
        .feedback-item {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0px;
            border: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .feedback-content {
            flex: 1;
        }
        .feedback-type {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .feedback-like {
            background: #d4edda;
            color: #155724;
        }
        .feedback-dislike {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            text-align: center;
            color: #666;
            padding: 40px;
        }
        .no-logs {
            text-align: center;
            color: #666;
            padding: 40px;
            font-size: 18px;
        }
        .auto-refresh {
            margin-left: 10px;
            font-size: 12px;
            color: #666;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .btn-warning {
            background: radial-gradient(circle at center, #ffc107 0%, #e0a800 40%, #d39e00 70%, #b08800 100%);
            color: #212529;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Í¥ÄÎ¶¨Ïûê - ÎåÄÌôî Î°úÍ∑∏</h1>
        <div class="header-buttons">
            <a href="/" class="btn btn-primary">ü§ñ Ï±óÎ¥á</a>
            <button class="btn btn-primary" onclick="refreshData()">ÏÉàÎ°úÍ≥†Ïπ®</button>
            <a href="/admin/logout" class="btn btn-secondary">Î°úÍ∑∏ÏïÑÏõÉ</a>
        </div>
    </div>
    
    <div class="stats" id="stats">
        <div class="loading">ÌÜµÍ≥Ñ Î°úÎî© Ï§ë...</div>
    </div>
    
    <div class="controls">
        <div style="margin-bottom: 15px;">
            <strong>ÌÉ≠ ÏÑ†ÌÉù:</strong>
            <button class="btn btn-primary" onclick="showTab('chat')" id="tab-chat">üí¨ ÎåÄÌôî Î°úÍ∑∏</button>
            <button class="btn btn-feedback" onclick="showTab('feedback')" id="tab-feedback">üëç ÌîºÎìúÎ∞± Î°úÍ∑∏</button>
            <button class="btn btn-warning" onclick="showTab('data')" id="tab-data">üìö Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</button>
        </div>
    </div>
    
    <!-- ÎåÄÌôî Î°úÍ∑∏ ÌÉ≠ -->
    <div id="chat-tab" class="tab-content active">
        <div class="controls">
            <div style="margin-bottom: 15px;">
                <strong>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïÑÌÑ∞:</strong>
                <button class="btn btn-primary" onclick="loadLogsByCategory('all')" id="btn-all">Ï†ÑÏ≤¥</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('Ïã†Ï≤≠Î∞©Î≤ï')" id="btn-Ïã†Ï≤≠Î∞©Î≤ï">Ïã†Ï≤≠Î∞©Î≤ï</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ÌíàÎ™©')" id="btn-ÌíàÎ™©">ÌíàÎ™©</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('Îì±Í∏âÏã†Ï≤≠Ï°∞Í±¥')" id="btn-Îì±Í∏âÏã†Ï≤≠Ï°∞Í±¥">Îì±Í∏âÏã†Ï≤≠Ï°∞Í±¥</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('Î≥∏Ïù∏Î∂ÄÎã¥Î•†')" id="btn-Î≥∏Ïù∏Î∂ÄÎã¥Î•†">Î≥∏Ïù∏Î∂ÄÎã¥Î•†</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ÏûêÍ≤©ÌôïÏù∏')" id="btn-ÏûêÍ≤©ÌôïÏù∏">ÏûêÍ≤©ÌôïÏù∏</button>
                <button class="btn btn-blocked" onclick="loadLogsByCategory('Ï∞®Îã®ÎêúÏßàÎ¨∏')" id="btn-Ï∞®Îã®ÎêúÏßàÎ¨∏">Ï∞®Îã®ÎêúÏßàÎ¨∏</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('Í∏∞ÌÉÄ')" id="btn-Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</button>
            </div>
            <div>
                <strong>Í∞úÏàòÎ≥Ñ ÌïÑÌÑ∞:</strong>
                <button class="btn btn-primary" onclick="loadLogs(20)">ÏµúÍ∑º 20Í∞ú</button>
                <button class="btn btn-primary" onclick="loadLogs(50)">ÏµúÍ∑º 50Í∞ú</button>
                <button class="btn btn-primary" onclick="loadLogs(100)">ÏµúÍ∑º 100Í∞ú</button>
                <button class="btn btn-primary" onclick="loadLogs()">Ï†ÑÏ≤¥</button>
                <span class="auto-refresh">ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®: 30Ï¥à</span>
            </div>
        </div>
        
        <div id="logs">
            <div class="loading">Î°úÎî© Ï§ë...</div>
        </div>
    </div>
    
    <!-- ÌîºÎìúÎ∞± Î°úÍ∑∏ ÌÉ≠ -->
    <div id="feedback-tab" class="tab-content">
        <div class="feedback-section">
            <h3>üìä ÌîºÎìúÎ∞± ÌïÑÌÑ∞</h3>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="loadFeedbackLogs('all')" id="btn-feedback-all">Ï†ÑÏ≤¥ ÌîºÎìúÎ∞±</button>
                <button class="btn btn-feedback" onclick="loadFeedbackLogs('like')" id="btn-feedback-like">üëç Ï¢ãÏïÑÏöîÎßå</button>
                <button class="btn btn-feedback dislike" onclick="loadFeedbackLogs('dislike')" id="btn-feedback-dislike">üëé Ïã´Ïñ¥ÏöîÎßå</button>
            </div>
        </div>
        
        <div id="feedback-logs">
            <div class="loading">ÌîºÎìúÎ∞± Î°úÎî© Ï§ë...</div>
        </div>
    </div>
    
    <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ÌÉ≠ -->
    <div id="data-tab" class="tab-content">
        <div class="feedback-section">
            <h3>üìö Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
            
            <!-- ÏÉà Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä -->
            <div style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 5px;">
                <h4>üìù ÏÉà Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä</h4>
                <div class="form-group">
                    <label for="new-title">Ï†úÎ™©:</label>
                    <input type="text" id="new-title" placeholder="ÏÉà Î¨∏ÏÑúÏùò Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="new-url">URL (ÏÑ†ÌÉùÏÇ¨Ìï≠):</label>
                    <input type="text" id="new-url" placeholder="Í¥ÄÎ†® URLÏù¥ ÏûàÎã§Î©¥ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="new-content">ÎÇ¥Ïö©:</label>
                    <textarea id="new-content" placeholder="ÏÉà Î¨∏ÏÑúÏùò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                </div>
                <button class="btn btn-feedback" onclick="addNewData()">üìÑ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä</button>
            </div>
            
            <!-- JSON ÌååÏùºÎ°ú Ï∂îÍ∞Ä -->
            <div style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 5px;">
                <h4>üìÅ JSON ÌååÏùºÎ°ú Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä</h4>
                <div class="form-group">
                    <label for="json-filename">JSON ÌååÏùºÎ™Ö:</label>
                    <input type="text" id="json-filename" placeholder="Ïòà: new_data.json" value="">
                </div>
                <button class="btn btn-feedback" onclick="addFromJsonFile()">üìÅ JSON ÌååÏùº Ï∂îÍ∞Ä</button>
            </div>
            
            <!-- Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Ïû¨Íµ¨Ï∂ï -->
            <div style="background: #fff3cd; padding: 20px; border-radius: 5px;">
                <h4>üîÑ Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Ïû¨Íµ¨Ï∂ï</h4>
                <p>‚ö†Ô∏è Ï£ºÏùò: Ïù¥ ÏûëÏóÖÏùÄ Í∏∞Ï°¥ Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥Î•º ÏôÑÏ†ÑÌûà ÏÇ≠Ï†úÌïòÍ≥† Í∏∞Î≥∏ JSON Îç∞Ïù¥ÌÑ∞Î°úÎßå Ïû¨Íµ¨Ï∂ïÌï©ÎãàÎã§.</p>
                <button class="btn btn-blocked" onclick="rebuildVectorstore()">üîÑ Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Ïû¨Íµ¨Ï∂ï</button>
            </div>
        </div>
        
        <div id="data-result" style="margin-top: 20px;"></div>
    </div>

    <script>
        let autoRefreshInterval;
        let currentTab = 'chat';
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ko-KR');
        }
        
        function getStatusText(status) {
            return status === 'success' ? 'ÏÑ±Í≥µ' : 'Ï∞®Îã®/Ïò§Î•ò';
        }
        
        function getStatusClass(status) {
            return status === 'success' ? 'status-success' : 'status-fallback';
        }
        
        function showTab(tabName) {
            currentTab = tabName;
            
            // Î™®Îì† ÌÉ≠ Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ Î≥¥Ïù¥Í∏∞
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('btn-feedback', 'btn-warning');
                btn.classList.add('btn-primary');
            });
            
            if (tabName === 'feedback') {
                document.getElementById('tab-feedback').classList.remove('btn-primary');
                document.getElementById('tab-feedback').classList.add('btn-feedback');
                loadFeedbackLogs('all');
            } else if (tabName === 'data') {
                document.getElementById('tab-data').classList.remove('btn-primary');
                document.getElementById('tab-data').classList.add('btn-warning');
            } else {
                document.getElementById('tab-chat').classList.remove('btn-primary');
                document.getElementById('tab-chat').classList.add('btn-feedback');
                loadLogs();
            }
        }
        
        async function loadStats() {
            try {
                const [chatResponse, feedbackResponse] = await Promise.all([
                    fetch('/admin/api/logs'),
                    fetch('/admin/api/feedback')
                ]);
                
                const chatData = await chatResponse.json();
                const feedbackData = await feedbackResponse.json();
                
                const totalQuestions = chatData.logs.length;
                const successCount = chatData.logs.filter(log => log.status === 'success').length;
                const fallbackCount = totalQuestions - successCount;
                const successRate = totalQuestions > 0 ? Math.round((successCount / totalQuestions) * 100) : 0;
                
                const likeCount = feedbackData.feedback_logs.filter(f => f.feedback_type === 'like').length;
                const dislikeCount = feedbackData.feedback_logs.filter(f => f.feedback_type === 'dislike').length;
                const totalFeedback = likeCount + dislikeCount;
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞ (Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏Ïö©)
                const categoryStats = {};
                chatData.logs.forEach(log => {
                    const category = log.category || 'Í∏∞ÌÉÄ';
                    if (!categoryStats[category]) {
                        categoryStats[category] = 0;
                    }
                    categoryStats[category]++;
                });
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalQuestions}</div>
                        <div class="stat-label">Ï†ÑÏ≤¥ ÏßàÎ¨∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${successCount}</div>
                        <div class="stat-label">ÏÑ±Í≥µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalFeedback}</div>
                        <div class="stat-label">Ï¥ù ÌîºÎìúÎ∞±</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${likeCount}</div>
                        <div class="stat-label">üëç Ï¢ãÏïÑÏöî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${dislikeCount}</div>
                        <div class="stat-label">üëé Ïã´Ïñ¥Ïöî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${successRate}%</div>
                        <div class="stat-label">ÏÑ±Í≥µÎ•†</div>
                    </div>
                `;
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäºÏóê Í∞úÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                updateCategoryButtonCounts(categoryStats);
            } catch (error) {
                console.error('ÌÜµÍ≥Ñ Î°úÎìú Ïã§Ìå®:', error);
            }
        }
        
        function updateCategoryButtonCounts(categoryStats) {
            // Ï†ÑÏ≤¥ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            const totalCount = Object.values(categoryStats).reduce((sum, count) => sum + count, 0);
            const allButton = document.getElementById('btn-all');
            if (allButton) {
                allButton.textContent = `Ï†ÑÏ≤¥ (${totalCount})`;
            }
            
            // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            const categories = ['Ïã†Ï≤≠Î∞©Î≤ï', 'ÌíàÎ™©', 'Îì±Í∏âÏã†Ï≤≠Ï°∞Í±¥', 'Î≥∏Ïù∏Î∂ÄÎã¥Î•†', 'ÏûêÍ≤©ÌôïÏù∏', 'Ï∞®Îã®ÎêúÏßàÎ¨∏', 'Í∏∞ÌÉÄ'];
            categories.forEach(category => {
                const button = document.getElementById(`btn-${category}`);
                if (button) {
                    const count = categoryStats[category] || 0;
                    button.textContent = `${category} (${count})`;
                }
            });
        }
        
        async function loadLogs(limit = null) {
            try {
                const url = limit ? `/admin/api/logs?limit=${limit}` : '/admin/api/logs';
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.logs && data.logs.length > 0) {
                    const logsHtml = data.logs.map(log => `
                        <div class="log-item">
                            <div class="log-header">
                                <span class="log-time">${formatTime(log.timestamp)}</span>
                                <span class="log-status ${getStatusClass(log.status)}">${getStatusText(log.status)}</span>
                                <span class="log-category" style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">${log.category || 'Í∏∞ÌÉÄ'}</span>
                            </div>
                            <div class="log-content">
                                <div class="log-question">
                                    <strong>ÏßàÎ¨∏:</strong> ${log.question}
                                </div>
                                <div class="log-answer">
                                    <strong>ÎãµÎ≥Ä:</strong> ${log.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('logs').innerHTML = logsHtml;
                } else {
                    document.getElementById('logs').innerHTML = '<div class="no-logs">ÏïÑÏßÅ ÎåÄÌôî Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                }
            } catch (error) {
                console.error('Î°úÍ∑∏ Î°úÎìú Ïã§Ìå®:', error);
                document.getElementById('logs').innerHTML = '<div class="loading">Î°úÎìú Ïã§Ìå®</div>';
            }
        }
        
        async function loadLogsByCategory(category) {
            try {
                console.log(`Ïπ¥ÌÖåÍ≥†Î¶¨ '${category}' Î°úÎî© Ï§ë...`);
                const url = `/admin/api/logs?category=${category}`;
                const response = await fetch(url);
                const data = await response.json();
                
                console.log(`Ïπ¥ÌÖåÍ≥†Î¶¨ '${category}' Í≤∞Í≥º:`, data.logs.length, 'Í∞ú Î°úÍ∑∏');
                
                if (data.logs && data.logs.length > 0) {
                    const logsHtml = data.logs.map(log => `
                        <div class="log-item">
                            <div class="log-header">
                                <span class="log-time">${formatTime(log.timestamp)}</span>
                                <span class="log-status ${getStatusClass(log.status)}">${getStatusText(log.status)}</span>
                                <span class="log-category" style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">${log.category || 'Í∏∞ÌÉÄ'}</span>
                            </div>
                            <div class="log-content">
                                <div class="log-question">
                                    <strong>ÏßàÎ¨∏:</strong> ${log.question}
                                </div>
                                <div class="log-answer">
                                    <strong>ÎãµÎ≥Ä:</strong> ${log.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('logs').innerHTML = logsHtml;
                } else {
                    document.getElementById('logs').innerHTML = `<div class="no-logs">'${category}' Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÎåÄÌôî Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§. (Ï¥ù ${data.logs ? data.logs.length : 0}Í∞ú)</div>`;
                }
                
                // ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÌïòÏù¥ÎùºÏù¥Ìä∏
                highlightSelectedCategory(category);
            } catch (error) {
                console.error('Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î°úÍ∑∏ Î°úÎìú Ïã§Ìå®:', error);
                document.getElementById('logs').innerHTML = '<div class="loading">Î°úÎìú Ïã§Ìå®</div>';
            }
        }
        
        async function loadFeedbackLogs(type = 'all') {
            try {
                const url = type === 'all' ? '/admin/api/feedback' : `/admin/api/feedback?type=${type}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.feedback_logs && data.feedback_logs.length > 0) {
                    const feedbackHtml = data.feedback_logs.map(feedback => `
                        <div class="feedback-item">
                            <div class="feedback-content">
                                <div style="margin-bottom: 10px;">
                                    <strong>ÏãúÍ∞Ñ:</strong> ${formatTime(feedback.timestamp)}
                                    <span class="feedback-type ${feedback.feedback_type === 'like' ? 'feedback-like' : 'feedback-dislike'}">
                                        ${feedback.feedback_type === 'like' ? 'üëç Ï¢ãÏïÑÏöî' : 'üëé Ïã´Ïñ¥Ïöî'}
                                    </span>
                                </div>
                                <div style="margin-bottom: 5px;">
                                    <strong>ÏßàÎ¨∏:</strong> ${feedback.question}
                                </div>
                                <div>
                                    <strong>ÎãµÎ≥Ä:</strong> ${feedback.answer.length > 100 ? feedback.answer.substring(0, 100) + '...' : feedback.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('feedback-logs').innerHTML = feedbackHtml;
                } else {
                    document.getElementById('feedback-logs').innerHTML = '<div class="no-logs">ÏïÑÏßÅ ÌîºÎìúÎ∞±Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                }
                
                // ÏÑ†ÌÉùÎêú ÌîºÎìúÎ∞± Î≤ÑÌäº ÌïòÏù¥ÎùºÏù¥Ìä∏
                highlightSelectedFeedback(type);
            } catch (error) {
                console.error('ÌîºÎìúÎ∞± Î°úÎìú Ïã§Ìå®:', error);
                document.getElementById('feedback-logs').innerHTML = '<div class="loading">Î°úÎìú Ïã§Ìå®</div>';
            }
        }
        
        function highlightSelectedCategory(selectedCategory) {
            // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäºÏùò Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî
            const categories = ['all', 'Ïã†Ï≤≠Î∞©Î≤ï', 'ÌíàÎ™©', 'Îì±Í∏âÏã†Ï≤≠Ï°∞Í±¥', 'Î≥∏Ïù∏Î∂ÄÎã¥Î•†', 'ÏûêÍ≤©ÌôïÏù∏', 'Ï∞®Îã®ÎêúÏßàÎ¨∏', 'Í∏∞ÌÉÄ'];
            categories.forEach(category => {
                const button = document.getElementById(`btn-${category}`);
                if (button) {
                    if (category === 'Ï∞®Îã®ÎêúÏßàÎ¨∏') {
                        button.style.background = 'radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%)';
                    } else {
                        button.style.background = 'radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%)';
                    }
                    button.style.transform = 'none';
                }
            });
            
            // ÏÑ†ÌÉùÎêú Î≤ÑÌäº ÌïòÏù¥ÎùºÏù¥Ìä∏
            const selectedButton = document.getElementById(`btn-${selectedCategory}`);
            if (selectedButton) {
                if (selectedCategory === 'Ï∞®Îã®ÎêúÏßàÎ¨∏') {
                    selectedButton.style.background = 'radial-gradient(circle at center, #e74c3c 0%, #dc3545 40%, #c82333 70%, #bd2130 100%)';
                } else {
                    selectedButton.style.background = 'radial-gradient(circle at center, #667eea 0%, #5a67d8 40%, #4c51bf 70%, #434190 100%)';
                }
                selectedButton.style.transform = 'translateY(-2px)';
            }
        }
        
        function highlightSelectedFeedback(selectedType) {
            // Î™®Îì† ÌîºÎìúÎ∞± Î≤ÑÌäºÏùò Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî
            const types = ['all', 'like', 'dislike'];
            types.forEach(type => {
                const button = document.getElementById(`btn-feedback-${type}`);
                if (button) {
                    button.style.transform = 'none';
                    if (type === 'dislike') {
                        button.style.background = 'radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%)';
                    } else if (type === 'like') {
                        button.style.background = 'radial-gradient(circle at center, #28a745 0%, #218838 40%, #1e7e34 70%, #155724 100%)';
                    } else {
                        button.style.background = 'radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%)';
                    }
                }
            });
            
            // ÏÑ†ÌÉùÎêú Î≤ÑÌäº ÌïòÏù¥ÎùºÏù¥Ìä∏
            const selectedButton = document.getElementById(`btn-feedback-${selectedType}`);
            if (selectedButton) {
                selectedButton.style.transform = 'translateY(-2px)';
            }
        }
        
        function refreshData() {
            loadStats();
            if (currentTab === 'chat') {
                loadLogs();
            } else if (currentTab === 'feedback') {
                loadFeedbackLogs('all');
            }
            // data ÌÉ≠ÏùÄ ÏÉàÎ°úÍ≥†Ïπ® ÏóÜÏùå
        }
        
        // ÏÉà Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä Ìï®Ïàò
        async function addNewData() {
            const title = document.getElementById('new-title').value.trim();
            const content = document.getElementById('new-content').value.trim();
            const url = document.getElementById('new-url').value.trim();
            
            if (!title || !content) {
                alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const response = await fetch('/admin/add_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        url: url
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚úÖ ${data.message}
                        </div>`;
                    
                    // Ìèº Ï¥àÍ∏∞Ìôî
                    document.getElementById('new-title').value = '';
                    document.getElementById('new-content').value = '';
                    document.getElementById('new-url').value = '';
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚ùå Ïò§Î•ò: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}
                    </div>`;
            }
        }
        
        // JSON ÌååÏùºÎ°ú Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä Ìï®Ïàò
        async function addFromJsonFile() {
            const filename = document.getElementById('json-filename').value.trim();
            
            if (!filename) {
                alert('JSON ÌååÏùºÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const response = await fetch('/admin/add_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        json_file: filename
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚úÖ ${data.message}
                        </div>`;
                    
                    // Ìèº Ï¥àÍ∏∞Ìôî
                    document.getElementById('json-filename').value = '';
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚ùå Ïò§Î•ò: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}
                    </div>`;
            }
        }
        
        // Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Ïû¨Íµ¨Ï∂ï Ìï®Ïàò
        async function rebuildVectorstore() {
            if (!confirm('Ï†ïÎßêÎ°ú Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥Î•º Ïû¨Íµ¨Ï∂ïÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ï∂îÍ∞ÄÎ°ú ÎÑ£ÏùÄ Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }
            
            try {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        üîÑ Î≤°ÌÑ∞Ïä§ÌÜ†Ïñ¥ Ïû¨Íµ¨Ï∂ï Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.
                    </div>`;
                
                const response = await fetch('/admin/rebuild_vectorstore', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚úÖ ${data.message}
                        </div>`;
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            ‚ùå Ïò§Î•ò: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}
                    </div>`;
            }
        }
        
        function startAutoRefresh() {
            // 30Ï¥àÎßàÎã§ ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
            autoRefreshInterval = setInterval(() => {
                refreshData();
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Î∞è ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë
        window.onload = function() {
            refreshData();
            startAutoRefresh();
        };
        
        // ÌéòÏù¥ÏßÄ Îñ†ÎÇ† Îïå ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® Ï§ëÏßÄ
        window.onbeforeunload = function() {
            stopAutoRefresh();
        };
    </script>
</body>
</html>