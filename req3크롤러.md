# req3.py — "법령자료실" 크롤러

**커뮤니티 키**: `B0018`, **첨부 루트**: `attachments1`

## 목적

법령자료실 게시판에서 공지사항 때와 동일한 방식으로 제목/본문/등록일/첨부파일을 수집하고, 파일을 변환/분류하여 RAG 입력용 CSV(`복지용구_법령자료실.csv`)를 생성합니다.

## req2와의 차이점(핵심만)

- **커뮤니티 키**: `B0018` (법령자료실) — 목록/상세 URL에 적용.
- **첨부 루트 디렉토리**: `attachments1` (공지와 분리 보관)
- **메인 루프 기본값**: `for page in range(1, 2)` → 현재 1페이지만 수집하도록 설정(운영 시 범위 확대 필요).

## 동작 흐름(나머지는 req2와 동일)

1. **목록→boardId 수집**: `communityKey=B0018`로 목록을 긁어와 고유 `boardId`들을 모읍니다.
2. **상세 파싱**: 제목/본문/등록일 추출 + 첨부 `<a>` 스캔 → 등록일 프리픽스+파일명으로 저장.
3. **첨부 다운로드**: 확장자별 폴더(`attachments1/...`)에 저장, PDF는 중복 방지·크기 검증 처리.
4. **HWP→PDF 변환**: 한컴 COM API를 이용한 자동 변환(중복/빈파일 방지 포함).
5. **PDF 텍스트/이미지 분류**: `PyMuPDF` 기반 이미지 XObject 유무 판별.
6. **CSV 저장**: `복지용구_법령자료실.csv`로 결과 저장(실패시 JSON 대체).

## 폴더/파일 구조

```
attachments1/
├── pdf/
│   ├── text/
│   └── image/
├── hwp/
├── xlsx/
├── xls/
└── zip/
```

**공지/법령을 물리적으로 분리 저장** → RAG 시 출처별 가중치/우선순위를 주거나, 출처 태그(`metadata`)로 활용하기 좋습니다.

## RAG 파이프라인에 바로 연결하는 팁

**임베딩 입력**: 두 CSV의 `content` 컬럼(본문)을 기본으로 임베딩하고, `title`, `reg_date`, `url`을 메타데이터로 함께 저장하세요. (예: `source=공지/법령`, `date=YYYYMMDD`)

**첨부 처리 전략**:
- `pdf/text/`는 일반 텍스트 추출기로, `pdf/image/`는 OCR로 분기.
- 추출 텍스트를 원문 게시글과 문서 단위로 묶어 하나의 문서로 인식시키면 검색 품질이 좋아집니다.

**최신순 랭킹**: 파일명 프리픽스(등록일) 덕분에 문자열 정렬만으로도 최신순 정렬이 가능합니다.

**중복 방지**: 프리픽스+원본명 조합으로 동일 제목의 반복 공지/개정본을 구분하거나 최신만 유지하기 쉽습니다.

## 운영/확장 포인트

**페이지 범위**: 현재 두 스크립트 모두 테스트 범위만 순회(공지: 2페이지만, 법령: 1페이지만). 운영 시 반복 수집(크론)과 증분 모드(이미 수집한 `boardId` 스킵)를 고려하세요.

**리트라이/타임아웃**: 요청 실패 대비 `requests` 재시도(backoff)와 더 긴 타임아웃, 프록시/휴먼 헤더 추가를 검토하세요.

**변환 파이프라인**: HWP→PDF 이후 텍스트 추출기(예: `PyMuPDF`/`PDFrw`) + OCR(`Tesseract`) 연동 스크립트를 붙이면 RAG 데이터 커버리지가 크게 늘어납니다.

**메타데이터 강화**: CSV에 `category=공지/법령`, `has_attachment`, `file_types` 컬럼을 추가해 검색 필터로 활용하세요.